@page "/emailSender"
@using MailKit.Net.Smtp
@using MimeKit

<h3>Send us a message</h3>


<div style="width: 400px; height: 400px;">
    <label for="message">Message:</label>
    <textarea id="message" style="width: 100%; height: 45%;" @bind="@messageText"></textarea>
    <button @onclick="SendEmail">Send</button>
    @if (isMessageSent)
    {
        <label style="color: green;">Success!</label>
    }
</div>




@code {
    private string messageText;
    private bool isMessageSent = false;

    private async Task SendEmail()
    {
        isMessageSent = false;
        var message = new MimeMessage();
        message.From.Add(new MailboxAddress("Client Message", "testgabrieltestac@gmail.com"));
        message.To.Add(new MailboxAddress("Car Dealership Manager", "testgabrieltestac@gmail.com"));
        message.Subject = "New Client Message";
        message.Body = new TextPart("plain")
            {
                Text = messageText
            };

        using (var client = new SmtpClient())
        {
            await client.ConnectAsync("smtp.gmail.com", 587, false);
            await client.AuthenticateAsync("testgabrieltestac@gmail.com", "itwsngxmtylicqda");
            await client.SendAsync(message);
            await client.DisconnectAsync(true);
        }
        isMessageSent = true;
        messageText = string.Empty;
    }
}
